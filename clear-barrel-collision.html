<!DOCTYPE html>
<html>
<head>
    <title>Clear Barrel Collision Data</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            background-color: #e8f5e9;
            border: 1px solid #4caf50;
        }
        .log {
            margin: 5px 0;
            color: #2e7d32;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Clear Barrel Collision Data</h1>
        <p>This page will automatically clear all barrel collision data from your browser storage.</p>
        
        <div class="status" id="status">
            <h3>Clearing barrel data...</h3>
            <div id="logs"></div>
        </div>
        
        <button onclick="window.location.href='index.html'">Go to Game</button>
        <button onclick="window.location.href='collision-editor-new.html'">Go to Collision Editor</button>
    </div>

    <script>
        function addLog(message) {
            const logsDiv = document.getElementById('logs');
            const logEntry = document.createElement('div');
            logEntry.className = 'log';
            logEntry.textContent = 'âœ“ ' + message;
            logsDiv.appendChild(logEntry);
        }

        function clearBarrelCollision() {
            console.log('Clearing barrel collision data and registry...');
            addLog('Starting cleanup process...');
            
            // Remove barrel collision data
            const barrelCollisionKey = 'sappyverse_collision_barrel';
            if (localStorage.getItem(barrelCollisionKey)) {
                localStorage.removeItem(barrelCollisionKey);
                console.log('Removed barrel collision data from localStorage');
                addLog('Removed barrel collision data from localStorage');
            } else {
                addLog('No barrel collision data found in localStorage');
            }
            
            // Remove barrel from model registry
            const registryKey = 'sappyverse_model_registry';
            const registryData = localStorage.getItem(registryKey);
            
            if (registryData) {
                try {
                    let models = JSON.parse(registryData);
                    const originalCount = models.length;
                    
                    // Filter out barrel
                    models = models.filter(model => model.name !== 'barrel');
                    
                    if (models.length < originalCount) {
                        localStorage.setItem(registryKey, JSON.stringify(models));
                        console.log('Removed barrel from model registry');
                        addLog('Removed barrel from model registry');
                    } else {
                        console.log('Barrel not found in model registry');
                        addLog('Barrel not found in model registry');
                    }
                } catch (e) {
                    console.error('Failed to parse model registry:', e);
                    addLog('Error parsing model registry: ' + e.message);
                }
            } else {
                addLog('No model registry found');
            }
            
            // Remove barrel from all collisions registry
            const allCollisionsKey = 'sappyverse_all_collisions';
            const allCollisions = localStorage.getItem(allCollisionsKey);
            
            if (allCollisions) {
                try {
                    let collisions = JSON.parse(allCollisions);
                    if (collisions.barrel) {
                        delete collisions.barrel;
                        localStorage.setItem(allCollisionsKey, JSON.stringify(collisions));
                        console.log('Removed barrel from all collisions registry');
                        addLog('Removed barrel from all collisions registry');
                    } else {
                        addLog('Barrel not found in all collisions registry');
                    }
                } catch (e) {
                    console.error('Failed to parse all collisions:', e);
                    addLog('Error parsing all collisions: ' + e.message);
                }
            } else {
                addLog('No all collisions registry found');
            }
            
            console.log('Barrel collision data and registry entries cleared!');
            addLog('Barrel cleanup complete! You can now create new collision data.');
        }

        // Run the cleanup automatically when page loads
        window.onload = function() {
            clearBarrelCollision();
        };
    </script>
</body>
</html>